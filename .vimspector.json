{
  "$schema": "https://puremourning.github.io/vimspector/schema/vimspector.schema.json",
  "configurations": {
    "debug platformio build": {
      "adapter": "debugpy",
      "configuration": {
        "request": "launch",
        "cwd": "${workspaceRoot}",
        "module": "platformio",
        "args": ["*${args:run -e debug}"],
        "console": "integratedTerminal",
        "justMyCode": false,
        "stopOnEntry": true
      }
    },

    "attach and reset": {
      "adapter": "vscode-cpptools",

      "variables": {
        "cwd": "${workspaceFolder}",
        "program": "${workspaceFolder}/.pio/build/debug/firmware.elf",
        "port": "${unusedLocalPort}"
      },
      "configuration": {
        "request": "launch",
        "program": "${program}",
        "stopAtEntry": false,
        "externalConsole": false,

        "MIMode": "gdb",
        "MIDebuggerPath": "arm-none-eabi-gdb",
        "MIDebuggerServerAddress": "localhost:${port}",
        "targetArchitecture": "arm",

        "debugServerPath": "openocd",
        "debugServerArgs": "-c \"gdb_port ${port}; tcl_port disabled; telnet_port disabled\" -f interface/stlink.cfg -c \"transport select hla_swd\" -f target/stm32f4x.cfg -c \"$$_TARGETNAME configure -event gdb-detach { resume }\" -c \"init\" -c \"reset halt\" -c \"arm semihosting enable\"",
        "serverStarted": "Listening on port \\d+ for gdb connections",
        "filterStdout": false,
        "filterStderr": true

        // "logging": {
        //   "exceptions": true,
        //   "moduleLoad": true,
        //   "programOutput": true,
        //   "engineLogging": true,
        //   "trace": true
        // }
      }
    },

    "attach and reset (stop at entry)": {
      "extends": "attach and reset",
      "configuration": {
        "request": "launch",
        "stopAtEntry": true
      }
    }
  }
}
